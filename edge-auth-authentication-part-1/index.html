<!doctype html><html lang=en-us><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=theme-color content="dark"><title>Edge Auth - Authentication - Part 1 | Dev Utkarsh</title><script async src="https://www.googletagmanager.com/gtag/js?id=G-NMJNTL3ZZN"></script>
<script>var doNotTrack=!1;if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-NMJNTL3ZZN",{anonymize_ip:!1})}</script><script type=application/javascript>var doNotTrack=!1;doNotTrack||(window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)},ga.l=+new Date,ga("create","G-NMJNTL3ZZN","auto"),ga("send","pageview"))</script><script async src=https://www.google-analytics.com/analytics.js></script><meta property="og:url" content="https://blog.devutkarsh.com/edge-auth-authentication-part-1/"><meta property="og:site_name" content="Dev Utkarsh Blog"><meta property="og:title" content="Edge Auth - Authentication - Part 1 | Dev Utkarsh"><meta property="og:description" content=" Single Factor Authentication in Java microservice using JWT token and JWKS KeySet validation. "><meta itemprop=name content="Edge Auth - Authentication - Part 1 | Dev Utkarsh"><meta name=twitter:title content="Edge Auth - Authentication - Part 1 | Dev Utkarsh"><meta name=application-name content="Edge Auth - Authentication - Part 1 | Dev Utkarsh"><meta name=description content="Single Factor Authentication in Java microservice using JWT token and JWKS KeySet validation."><meta name=twitter:description content="Single Factor Authentication in Java microservice using JWT token and JWKS KeySet validation. "><meta itemprop=description content=" Single Factor Authentication in Java microservice using JWT token and JWKS KeySet validation. "><meta property="og:image" content="https://blog.devutkarsh.com/assets/images/tech/api-service.jpeg"><meta property="og:type" content="article"><meta property="article:publisher" content="Dev Utkarsh"><meta property="og:article:published_time" content="2022-07-01T00:00:00Z"><meta property="article:published_time" content="2022-07-01T00:00:00Z"><script defer type=application/ld+json>{"@context":"http://schema.org","@type":"Article","headline":"Edge Auth - Authentication - Part 1","author":{"@type":"Person","name":"Dev Utkarsh"},"datePublished":"2022-07-01","description":"Single Factor Authentication in Java microservice using JWT token and JWKS KeySet validation.","wordCount":1267,"mainEntityOfPage":"True","dateModified":"2022-07-01","publisher":{"@type":"Organization","name":"Dev Utkarsh","logo":{"@type":"imageObject","url":"https:\/\/blog.devutkarsh.com\/favicon.ico"}}}</script><link rel="shortcut icon" type=image/x-icon href=/favicon.ico><link rel=stylesheet href=/sass/main.min.f13493bc932ede4e3db6190b3b3f1f70d3585e010477a450a433a4d4d7dab03f.css><style>:root{--article-font-family:"Titillium Web", var(--base-font-family)}</style><script>(function(){const e=document.createElement("link");e.href="https://fonts.googleapis.com/css2?family=Titillium+Web:wght@400;700&display=swap",e.type="text/css",e.rel="stylesheet",document.head.appendChild(e)})()</script><div id=fb-root></div></head><script>(function(){const t="ThemeColorScheme",e=localStorage.getItem(t),n=window.matchMedia("(prefers-color-scheme: dark)").matches===!0;e=="dark"||e==="dark"&&n?document.documentElement.dataset.userColorScheme="dark":document.documentElement.dataset.userColorScheme="light"})()</script><body class=dark><nav class=navbar><div class=container><div class=flex><div><a class=brand href=/>Dev Utkarsh</a></div><div class=flex><a href=/articles/>Articles</a>
<a href=https://devutkarsh.com>Music</a>
<button id=dark-mode-button><svg class="light" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" aria-hidden="true" focusable="false" width="1em" height="1em" style="-ms-transform:rotate(360deg);-webkit-transform:rotate(360deg);transform:rotate(360deg)" viewBox="0 0 36 36"><path fill="#ffd983" d="M30.312.776C32 19 20 32 .776 30.312c8.199 7.717 21.091 7.588 29.107-.429C37.9 21.867 38.03 8.975 30.312.776z"/><path d="M30.705 15.915a1.163 1.163.0 101.643 1.641 1.163 1.163.0 00-1.643-1.641zm-16.022 14.38a1.74 1.74.0 000 2.465 1.742 1.742.0 100-2.465zm13.968-2.147a2.904 2.904.0 01-4.108.0 2.902 2.902.0 010-4.107 2.902 2.902.0 014.108.0 2.902 2.902.0 010 4.107z" fill="#ffcc4d"/><rect x="0" y="0" width="36" height="36" fill="rgba(0, 0, 0, 0)"/></svg><svg class="dark" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" aria-hidden="true" focusable="false" width="1em" height="1em" style="-ms-transform:rotate(360deg);-webkit-transform:rotate(360deg);transform:rotate(360deg)" viewBox="0 0 36 36"><path fill="#ffd983" d="M16 2s0-2 2-2 2 2 2 2v2s0 2-2 2-2-2-2-2V2zm18 14s2 0 2 2-2 2-2 2h-2s-2 0-2-2 2-2 2-2h2zM4 16s2 0 2 2-2 2-2 2H2s-2 0-2-2 2-2 2-2h2zm5.121-8.707s1.414 1.414.0 2.828-2.828.0-2.828.0L4.878 8.708s-1.414-1.414.0-2.829c1.415-1.414 2.829.0 2.829.0l1.414 1.414zm21 21s1.414 1.414.0 2.828-2.828.0-2.828.0l-1.414-1.414s-1.414-1.414.0-2.828 2.828.0 2.828.0l1.414 1.414zm-.413-18.172s-1.414 1.414-2.828.0.0-2.828.0-2.828l1.414-1.414s1.414-1.414 2.828.0.0 2.828.0 2.828l-1.414 1.414zm-21 21s-1.414 1.414-2.828.0.0-2.828.0-2.828l1.414-1.414s1.414-1.414 2.828.0.0 2.828.0 2.828l-1.414 1.414zM16 32s0-2 2-2 2 2 2 2v2s0 2-2 2-2-2-2-2v-2z"/><circle fill="#ffd983" cx="18" cy="18" r="10"/><rect x="0" y="0" width="36" height="36" fill="rgba(0, 0, 0, 0)"/></svg></button></div></div></div></nav><main><div class=container><article><header class=article-header><div class=thumb><div><h1>Edge Auth - Authentication - Part 1</h1><div class=post-meta><div>By Dev Utkarsh | <time>July 01, 2022</time>
| 6 minutes</div><div class=tags><a href=/tags/microservice/>microservice</a>
<a href=/tags/java/>java</a>
<a href=/tags/security/>security</a></div></div></div></div></header></article><div class=article-post><p><img loading=lazy src=/assets/images/tech/edge-auth.jpeg alt=edge-auth width=823 height=361></p><h2 id=what-is-edge-authentication><a href=#what-is-edge-authentication class=anchor><svg class="icon" aria-hidden="true" focusable="false" height="16" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5.0-3-1.69-3-3.5S2.55 3 4 3h4c1.45.0 3 1.69 3 3.5.0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98.0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98.0-2-1.22-2-2.5.0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45.0 3-1.69 3-3.5S14.5 6 13 6z"/></svg></a>What is edge authentication?</h2><blockquote><p>Edge authentication or authorization is a way to validate all the requests before they reach the actual microservice or private networks i.e. at the edge. This is done at a global level for all the services, so that individual microservice do not have to handle the authentication or authorization on thier own.
This removes the security overhead from all microservices so that they can communicate insecurely in the mesh within a private network and focus on only concerned business logic.</p></blockquote><p>A JWT Token is generated at the edge using username & password after a Single Factor Authentication (SFA) in this demo, as in the diagram above. The JWT token is then used in all the subsequent API calls which are validated and authorized at a L7 reverse proxy service like nginx or netflix zuul or spring gateway. Once the token is validated and route access is authorized, the claims from the JWT are decoded and added to the header before passing to the downstream services.</p><blockquote><p><strong>For this session we will focus only on how to build a Edge Auth service in SFA. How to generate a JWT token and the JWKS WebKey Sets using Java. We will utilize auth0 for JWT and nibus-jose libraries for JWKS KeySet. This turns the edge-auth service to behave like a ID server.</strong></p></blockquote><p>In the images added above we have a gateway, which exposes 2 public endpoints -</p><ul><li><code>/login</code> is exposed to get username password and on successful authentication responds with a JWT token and claims like username and user-type.</li><li><code>/.well-known/jwks.json</code> is a public JSON WebSet Keys endpoint which has public key to verify and validate the token which is signed with it&rsquo;s corresponding private key. This can be used if any external service wants to verify the authenticity of your token. Mostly the JWKS endpoints are public for external services to verify the token whenever required.</li></ul><p>Then there is a private endpoint which is token hungry -</p><ul><li><code>/validate</code> - This is to also to Authenticate token but most importantly Authorize and validate whether a requested endpoint or URL with a valid token is allowed access to the user based on it&rsquo;s user-type. This is controlled using the Open Policy Agent or say OPA.
So a user with user-type admin should be open to all admin API&rsquo;s but a normal user like a customer should not be allowed to access the admin API. This is controlled using Open Policy Agent and rego rules.</li></ul><p>Let&rsquo;s see how to develop the authentication module first -</p><p>The Auth controller for login module and generates JWT token after validating username password. Also, we have the validation endpoints where we generate the JWKS endpoint. And a valiate endpoint for authorization, which we will cover later.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=nd>@RestController</span>
</span></span><span class=line><span class=cl><span class=nd>@RequestMapping</span><span class=o>(</span><span class=s>&#34;/&#34;</span><span class=o>)</span>
</span></span><span class=line><span class=cl><span class=nd>@Slf4j</span>
</span></span><span class=line><span class=cl><span class=kd>public</span> <span class=kd>class</span> <span class=nc>AuthController</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nd>@Autowired</span>
</span></span><span class=line><span class=cl>    <span class=n>AuthOperations</span> <span class=n>authOperations</span><span class=o>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nd>@PostMapping</span><span class=o>(</span><span class=s>&#34;/login&#34;</span><span class=o>)</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=n>ResponseEntity</span><span class=o>&lt;</span><span class=n>String</span><span class=o>&gt;</span> <span class=nf>login</span><span class=o>(</span><span class=nd>@RequestBody</span> <span class=n>HashMap</span><span class=o>&lt;</span><span class=n>String</span><span class=o>,</span> <span class=n>String</span><span class=o>&gt;</span> <span class=n>credentials</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=n>log</span><span class=o>.</span><span class=na>info</span><span class=o>(</span><span class=s>&#34;Login Controller..&#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=c1>// call some real validation API with credentials
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=k>return</span> <span class=k>new</span> <span class=n>ResponseEntity</span><span class=o>&lt;&gt;(</span><span class=n>authOperations</span><span class=o>.</span><span class=na>generateToken</span><span class=o>(),</span> <span class=n>HttpStatus</span><span class=o>.</span><span class=na>OK</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nd>@GetMapping</span><span class=o>(</span><span class=s>&#34;/.well-known/jwks.json&#34;</span><span class=o>)</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=n>ResponseEntity</span><span class=o>&lt;?&gt;</span> <span class=n>jwksEndpoint</span><span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=n>log</span><span class=o>.</span><span class=na>info</span><span class=o>(</span><span class=s>&#34;JWKS keyset Controller..&#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=n>HttpHeaders</span> <span class=n>responseHeaders</span> <span class=o>=</span> <span class=k>new</span> <span class=n>HttpHeaders</span><span class=o>();</span>
</span></span><span class=line><span class=cl>        <span class=n>responseHeaders</span><span class=o>.</span><span class=na>set</span><span class=o>(</span><span class=s>&#34;Content-Type&#34;</span><span class=o>,</span> <span class=s>&#34;application/json&#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=k>new</span> <span class=n>ResponseEntity</span><span class=o>&lt;&gt;(</span><span class=n>authOperations</span><span class=o>.</span><span class=na>jwksKeySet</span><span class=o>(),</span> <span class=n>responseHeaders</span><span class=o>,</span> <span class=n>HttpStatus</span><span class=o>.</span><span class=na>OK</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nd>@PostMapping</span><span class=o>(</span><span class=s>&#34;/validate&#34;</span><span class=o>)</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=n>ResponseEntity</span><span class=o>&lt;</span><span class=n>Boolean</span><span class=o>&gt;</span> <span class=nf>validate</span><span class=o>(</span><span class=nd>@RequestBody</span> <span class=n>HashMap</span><span class=o>&lt;</span><span class=n>String</span><span class=o>,</span> <span class=n>String</span><span class=o>&gt;</span> <span class=n>requestTokenAndUri</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=n>log</span><span class=o>.</span><span class=na>info</span><span class=o>(</span><span class=s>&#34;Authorization token Controller..&#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=k>new</span> <span class=n>ResponseEntity</span><span class=o>&lt;</span><span class=n>Boolean</span><span class=o>&gt;(</span><span class=n>authOperations</span><span class=o>.</span><span class=na>authorize</span><span class=o>(</span><span class=n>requestTokenAndUri</span><span class=o>),</span> <span class=n>HttpStatus</span><span class=o>.</span><span class=na>OK</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></td></tr></table></div></div><p>The underlying service operations would be the logic on how to generate a token. We are using the public and private RSA keys for this example. We can store the private key in <code>application.yml</code> also. But for this example we will generate them dynamically.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span><span class=lnt>54
</span><span class=lnt>55
</span><span class=lnt>56
</span><span class=lnt>57
</span><span class=lnt>58
</span><span class=lnt>59
</span><span class=lnt>60
</span><span class=lnt>61
</span><span class=lnt>62
</span><span class=lnt>63
</span><span class=lnt>64
</span><span class=lnt>65
</span><span class=lnt>66
</span><span class=lnt>67
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=nd>@Component</span>
</span></span><span class=line><span class=cl><span class=nd>@Slf4j</span>
</span></span><span class=line><span class=cl><span class=kd>public</span> <span class=kd>class</span> <span class=nc>AuthOperations</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nd>@Autowired</span>
</span></span><span class=line><span class=cl>    <span class=n>KeysGenerator</span> <span class=n>keys</span><span class=o>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nd>@Value</span><span class=o>(</span><span class=s>&#34;${server.port}&#34;</span><span class=o>)</span>
</span></span><span class=line><span class=cl>    <span class=kd>private</span> <span class=n>String</span> <span class=n>serverPort</span><span class=o>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>UUID</span> <span class=n>kid</span> <span class=o>=</span> <span class=n>UUID</span><span class=o>.</span><span class=na>randomUUID</span><span class=o>();</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=n>String</span> <span class=nf>generateToken</span><span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=n>String</span> <span class=n>token</span> <span class=o>=</span> <span class=kc>null</span><span class=o>;</span>
</span></span><span class=line><span class=cl>        <span class=k>try</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>            <span class=n>PrivateKey</span> <span class=n>privateKey</span> <span class=o>=</span> <span class=o>(</span><span class=n>PrivateKey</span><span class=o>)</span> <span class=n>keys</span><span class=o>.</span><span class=na>getRSAKeys</span><span class=o>(</span><span class=n>KeysGeneratorStrategy</span><span class=o>.</span><span class=na>FILE</span><span class=o>).</span><span class=na>get</span><span class=o>(</span><span class=n>AuthConstants</span><span class=o>.</span><span class=na>PRIVATE_KEY</span><span class=o>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>            <span class=n>Date</span> <span class=n>today</span> <span class=o>=</span> <span class=k>new</span> <span class=n>Date</span><span class=o>();</span>
</span></span><span class=line><span class=cl>            <span class=n>Calendar</span> <span class=n>c</span> <span class=o>=</span> <span class=n>Calendar</span><span class=o>.</span><span class=na>getInstance</span><span class=o>();</span>
</span></span><span class=line><span class=cl>            <span class=n>c</span><span class=o>.</span><span class=na>setTime</span><span class=o>(</span><span class=n>today</span><span class=o>);</span>
</span></span><span class=line><span class=cl>            <span class=n>c</span><span class=o>.</span><span class=na>add</span><span class=o>(</span><span class=n>Calendar</span><span class=o>.</span><span class=na>DATE</span><span class=o>,</span> <span class=n>1</span><span class=o>);</span>
</span></span><span class=line><span class=cl>            <span class=n>Date</span> <span class=n>tomorrow</span> <span class=o>=</span> <span class=n>c</span><span class=o>.</span><span class=na>getTime</span><span class=o>();</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>            <span class=n>token</span> <span class=o>=</span> <span class=n>Jwts</span><span class=o>.</span><span class=na>builder</span><span class=o>()</span>
</span></span><span class=line><span class=cl>            <span class=o>.</span><span class=na>setHeaderParam</span><span class=o>(</span><span class=s>&#34;kid&#34;</span><span class=o>,</span> <span class=n>kid</span><span class=o>)</span>
</span></span><span class=line><span class=cl>            <span class=o>.</span><span class=na>setId</span><span class=o>(</span><span class=n>UUID</span><span class=o>.</span><span class=na>randomUUID</span><span class=o>().</span><span class=na>toString</span><span class=o>())</span>
</span></span><span class=line><span class=cl>            <span class=o>.</span><span class=na>setIssuedAt</span><span class=o>(</span><span class=n>today</span><span class=o>)</span>
</span></span><span class=line><span class=cl>            <span class=o>.</span><span class=na>setSubject</span><span class=o>(</span><span class=s>&#34;tester&#34;</span><span class=o>)</span>
</span></span><span class=line><span class=cl>            <span class=o>.</span><span class=na>setIssuer</span><span class=o>(</span><span class=s>&#34;localhost&#34;</span><span class=o>)</span>
</span></span><span class=line><span class=cl>            <span class=o>.</span><span class=na>setExpiration</span><span class=o>(</span><span class=n>tomorrow</span><span class=o>)</span>
</span></span><span class=line><span class=cl>            <span class=o>.</span><span class=na>signWith</span><span class=o>(</span><span class=n>privateKey</span><span class=o>)</span>
</span></span><span class=line><span class=cl>            <span class=o>.</span><span class=na>compact</span><span class=o>();</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>            <span class=n>log</span><span class=o>.</span><span class=na>info</span><span class=o>(</span><span class=s>&#34;Token generated&#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=o>}</span> <span class=k>catch</span> <span class=o>(</span><span class=n>Exception</span> <span class=n>e</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>            <span class=n>log</span><span class=o>.</span><span class=na>error</span><span class=o>(</span><span class=s>&#34;Cannot generate token&#34;</span><span class=o>,</span> <span class=n>e</span><span class=o>.</span><span class=na>getMessage</span><span class=o>());</span>
</span></span><span class=line><span class=cl>        <span class=o>}</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>token</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nd>@Cacheable</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=n>Map</span><span class=o>&lt;</span><span class=n>String</span><span class=o>,</span> <span class=n>List</span><span class=o>&lt;</span><span class=n>JSONObject</span><span class=o>&gt;&gt;</span> <span class=nf>jwksKeySet</span><span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=k>try</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>            <span class=n>PublicKey</span> <span class=n>publicKey</span> <span class=o>=</span> <span class=o>(</span><span class=n>PublicKey</span><span class=o>)</span> <span class=n>keys</span><span class=o>.</span><span class=na>getRSAKeys</span><span class=o>(</span><span class=n>KeysGeneratorStrategy</span><span class=o>.</span><span class=na>DYNAMIC</span><span class=o>).</span><span class=na>get</span><span class=o>(</span><span class=n>AuthConstants</span><span class=o>.</span><span class=na>PUBLIC_KEY</span><span class=o>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>            <span class=n>JWK</span> <span class=n>jwk</span> <span class=o>=</span> <span class=k>new</span> <span class=n>RSAKey</span><span class=o>.</span><span class=na>Builder</span><span class=o>((</span><span class=n>RSAPublicKey</span><span class=o>)</span> <span class=n>publicKey</span><span class=o>)</span>
</span></span><span class=line><span class=cl>                    <span class=o>.</span><span class=na>keyUse</span><span class=o>(</span><span class=n>KeyUse</span><span class=o>.</span><span class=na>SIGNATURE</span><span class=o>)</span>
</span></span><span class=line><span class=cl>                    <span class=o>.</span><span class=na>keyID</span><span class=o>(</span><span class=n>kid</span><span class=o>.</span><span class=na>toString</span><span class=o>())</span>
</span></span><span class=line><span class=cl>                    <span class=o>.</span><span class=na>build</span><span class=o>();</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>            <span class=n>Map</span><span class=o>&lt;</span><span class=n>String</span><span class=o>,</span> <span class=n>List</span><span class=o>&lt;</span><span class=n>JSONObject</span><span class=o>&gt;&gt;</span> <span class=n>keyset</span> <span class=o>=</span> <span class=k>new</span> <span class=n>HashMap</span><span class=o>&lt;</span><span class=n>String</span><span class=o>,</span> <span class=n>List</span><span class=o>&lt;</span><span class=n>JSONObject</span><span class=o>&gt;&gt;();</span>
</span></span><span class=line><span class=cl>            <span class=n>List</span><span class=o>&lt;</span><span class=n>JSONObject</span><span class=o>&gt;</span> <span class=n>keys</span> <span class=o>=</span> <span class=k>new</span> <span class=n>ArrayList</span><span class=o>&lt;</span><span class=n>JSONObject</span><span class=o>&gt;();</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>            <span class=n>keys</span><span class=o>.</span><span class=na>add</span><span class=o>(</span><span class=n>jwk</span><span class=o>.</span><span class=na>toJSONObject</span><span class=o>());</span>
</span></span><span class=line><span class=cl>            <span class=n>keyset</span><span class=o>.</span><span class=na>put</span><span class=o>(</span><span class=s>&#34;keys&#34;</span><span class=o>,</span> <span class=n>keys</span><span class=o>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=n>keyset</span><span class=o>;</span>
</span></span><span class=line><span class=cl>        <span class=o>}</span> <span class=k>catch</span> <span class=o>(</span><span class=n>Exception</span> <span class=n>e</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>            <span class=n>log</span><span class=o>.</span><span class=na>error</span><span class=o>(</span><span class=s>&#34;Cannot generate JWKS keyset&#34;</span><span class=o>,</span> <span class=n>e</span><span class=o>.</span><span class=na>getMessage</span><span class=o>());</span>
</span></span><span class=line><span class=cl>        <span class=o>}</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=kc>null</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=n>Boolean</span> <span class=nf>authorize</span><span class=o>(</span><span class=n>String</span> <span class=n>request</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=c1>// logic for OPA. JWT token and URI validation
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></td></tr></table></div></div><p>Beside the service is the core logic for dynamic RSA keys generation. Here we have 2 strategies to load the private keys, which is defined using the enum. We can read the private key from the file (recommended in case of microservices) and dynamically (just for this example).</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span><span class=lnt>54
</span><span class=lnt>55
</span><span class=lnt>56
</span><span class=lnt>57
</span><span class=lnt>58
</span><span class=lnt>59
</span><span class=lnt>60
</span><span class=lnt>61
</span><span class=lnt>62
</span><span class=lnt>63
</span><span class=lnt>64
</span><span class=lnt>65
</span><span class=lnt>66
</span><span class=lnt>67
</span><span class=lnt>68
</span><span class=lnt>69
</span><span class=lnt>70
</span><span class=lnt>71
</span><span class=lnt>72
</span><span class=lnt>73
</span><span class=lnt>74
</span><span class=lnt>75
</span><span class=lnt>76
</span><span class=lnt>77
</span><span class=lnt>78
</span><span class=lnt>79
</span><span class=lnt>80
</span><span class=lnt>81
</span><span class=lnt>82
</span><span class=lnt>83
</span><span class=lnt>84
</span><span class=lnt>85
</span><span class=lnt>86
</span><span class=lnt>87
</span><span class=lnt>88
</span><span class=lnt>89
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=nd>@Component</span>
</span></span><span class=line><span class=cl><span class=nd>@Slf4j</span>
</span></span><span class=line><span class=cl><span class=kd>public</span> <span class=kd>class</span> <span class=nc>KeysGenerator</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kd>enum</span> <span class=n>KeysGeneratorStrategy</span><span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=n>FILE</span><span class=o>,</span>
</span></span><span class=line><span class=cl>        <span class=n>DYNAMIC</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nd>@Value</span><span class=o>(</span><span class=s>&#34;${keys.private}&#34;</span><span class=o>)</span>
</span></span><span class=line><span class=cl>    <span class=kd>private</span> <span class=n>String</span> <span class=n>privateKeyString</span><span class=o>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>Map</span><span class=o>&lt;</span><span class=n>String</span><span class=o>,</span> <span class=n>Object</span><span class=o>&gt;</span> <span class=n>keys</span><span class=o>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=n>Map</span><span class=o>&lt;</span><span class=n>String</span><span class=o>,</span> <span class=n>Object</span><span class=o>&gt;</span> <span class=nf>getRSAKeys</span><span class=o>(</span><span class=n>KeysGeneratorStrategy</span> <span class=n>strategy</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=o>(</span><span class=kc>null</span> <span class=o>==</span> <span class=n>keys</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>            <span class=n>keys</span> <span class=o>=</span> <span class=n>genrateRSAKeys</span><span class=o>(</span><span class=n>strategy</span><span class=o>);</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=n>keys</span><span class=o>;</span>
</span></span><span class=line><span class=cl>        <span class=o>}</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=o>(</span><span class=n>keys</span><span class=o>.</span><span class=na>size</span><span class=o>()</span> <span class=o>&gt;</span> <span class=n>0</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=n>keys</span><span class=o>;</span>
</span></span><span class=line><span class=cl>        <span class=o>}</span> <span class=k>else</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>            <span class=n>keys</span> <span class=o>=</span> <span class=n>genrateRSAKeys</span><span class=o>(</span><span class=n>strategy</span><span class=o>);</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=n>keys</span><span class=o>;</span>
</span></span><span class=line><span class=cl>        <span class=o>}</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nd>@Cacheable</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=n>Map</span><span class=o>&lt;</span><span class=n>String</span><span class=o>,</span> <span class=n>Object</span><span class=o>&gt;</span> <span class=nf>genrateRSAKeys</span><span class=o>(</span><span class=n>KeysGeneratorStrategy</span> <span class=n>strategy</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=k>try</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>            <span class=n>log</span><span class=o>.</span><span class=na>info</span><span class=o>(</span><span class=s>&#34;Generating New Keys {}&#34;</span><span class=o>,</span> <span class=n>strategy</span><span class=o>);</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=k>if</span><span class=o>(</span><span class=n>strategy</span><span class=o>.</span><span class=na>equals</span><span class=o>(</span><span class=n>KeysGeneratorStrategy</span><span class=o>.</span><span class=na>FILE</span><span class=o>)){</span>
</span></span><span class=line><span class=cl>                <span class=n>PrivateKey</span> <span class=n>privateKey</span> <span class=o>=</span> <span class=n>getPrivateKey</span><span class=o>();</span>
</span></span><span class=line><span class=cl>                <span class=n>PublicKey</span> <span class=n>publicKey</span>  <span class=o>=</span> <span class=n>getPublicKey</span><span class=o>(</span><span class=n>privateKey</span><span class=o>);</span>
</span></span><span class=line><span class=cl>                <span class=n>Map</span><span class=o>&lt;</span><span class=n>String</span><span class=o>,</span> <span class=n>Object</span><span class=o>&gt;</span> <span class=n>keys</span> <span class=o>=</span> <span class=k>new</span> <span class=n>HashMap</span><span class=o>&lt;</span><span class=n>String</span><span class=o>,</span> <span class=n>Object</span><span class=o>&gt;();</span>
</span></span><span class=line><span class=cl>                <span class=n>keys</span><span class=o>.</span><span class=na>put</span><span class=o>(</span><span class=n>AuthConstants</span><span class=o>.</span><span class=na>PRIVATE_KEY</span><span class=o>,</span> <span class=n>privateKey</span><span class=o>);</span>
</span></span><span class=line><span class=cl>                <span class=n>keys</span><span class=o>.</span><span class=na>put</span><span class=o>(</span><span class=n>AuthConstants</span><span class=o>.</span><span class=na>PUBLIC_KEY</span><span class=o>,</span> <span class=n>publicKey</span><span class=o>);</span>
</span></span><span class=line><span class=cl>                <span class=n>log</span><span class=o>.</span><span class=na>info</span><span class=o>(</span><span class=s>&#34;Keys Added Successfully&#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl>                <span class=k>return</span> <span class=n>keys</span><span class=o>;</span>
</span></span><span class=line><span class=cl>            <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>            <span class=k>if</span><span class=o>(</span><span class=n>strategy</span><span class=o>.</span><span class=na>equals</span><span class=o>(</span><span class=n>KeysGeneratorStrategy</span><span class=o>.</span><span class=na>DYNAMIC</span><span class=o>)){</span>
</span></span><span class=line><span class=cl>                <span class=n>KeyPairGenerator</span> <span class=n>keyPairGenerator</span> <span class=o>=</span> <span class=n>KeyPairGenerator</span><span class=o>.</span><span class=na>getInstance</span><span class=o>(</span><span class=n>AuthConstants</span><span class=o>.</span><span class=na>KEYPAIR_GENERATOR_ALGORITHM</span><span class=o>);</span>
</span></span><span class=line><span class=cl>                <span class=n>keyPairGenerator</span><span class=o>.</span><span class=na>initialize</span><span class=o>(</span><span class=n>2048</span><span class=o>);</span>
</span></span><span class=line><span class=cl>                <span class=n>KeyPair</span> <span class=n>keyPair</span> <span class=o>=</span> <span class=n>keyPairGenerator</span><span class=o>.</span><span class=na>generateKeyPair</span><span class=o>();</span>
</span></span><span class=line><span class=cl>                <span class=n>PrivateKey</span> <span class=n>privateKey</span> <span class=o>=</span> <span class=n>keyPair</span><span class=o>.</span><span class=na>getPrivate</span><span class=o>();</span>
</span></span><span class=line><span class=cl>                <span class=n>PublicKey</span> <span class=n>publicKey</span> <span class=o>=</span> <span class=n>keyPair</span><span class=o>.</span><span class=na>getPublic</span><span class=o>();</span>
</span></span><span class=line><span class=cl>                <span class=n>Map</span><span class=o>&lt;</span><span class=n>String</span><span class=o>,</span> <span class=n>Object</span><span class=o>&gt;</span> <span class=n>keys</span> <span class=o>=</span> <span class=k>new</span> <span class=n>HashMap</span><span class=o>&lt;</span><span class=n>String</span><span class=o>,</span> <span class=n>Object</span><span class=o>&gt;();</span>
</span></span><span class=line><span class=cl>                <span class=n>keys</span><span class=o>.</span><span class=na>put</span><span class=o>(</span><span class=n>AuthConstants</span><span class=o>.</span><span class=na>PRIVATE_KEY</span><span class=o>,</span> <span class=n>privateKey</span><span class=o>);</span>
</span></span><span class=line><span class=cl>                <span class=n>keys</span><span class=o>.</span><span class=na>put</span><span class=o>(</span><span class=n>AuthConstants</span><span class=o>.</span><span class=na>PUBLIC_KEY</span><span class=o>,</span> <span class=n>publicKey</span><span class=o>);</span>
</span></span><span class=line><span class=cl>                <span class=n>log</span><span class=o>.</span><span class=na>info</span><span class=o>(</span><span class=s>&#34;Keys Generated Successfully&#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl>                <span class=k>return</span> <span class=n>keys</span><span class=o>;</span>
</span></span><span class=line><span class=cl>            <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=kc>null</span><span class=o>;</span>
</span></span><span class=line><span class=cl>        <span class=o>}</span> <span class=k>catch</span> <span class=o>(</span><span class=n>Exception</span> <span class=n>e</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>            <span class=n>log</span><span class=o>.</span><span class=na>error</span><span class=o>(</span><span class=s>&#34;Cannot generate RSA keys {}&#34;</span><span class=o>,</span> <span class=n>e</span><span class=o>);</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=kc>null</span><span class=o>;</span>
</span></span><span class=line><span class=cl>        <span class=o>}</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=n>PublicKey</span> <span class=nf>getPublicKey</span><span class=o>(</span><span class=n>PrivateKey</span> <span class=n>privateKey</span><span class=o>){</span>
</span></span><span class=line><span class=cl>        <span class=k>try</span><span class=o>{</span>
</span></span><span class=line><span class=cl>            <span class=n>RSAPrivateCrtKey</span> <span class=n>privk</span> <span class=o>=</span> <span class=o>(</span><span class=n>RSAPrivateCrtKey</span><span class=o>)</span> <span class=n>privateKey</span><span class=o>;</span>
</span></span><span class=line><span class=cl>            <span class=n>RSAPublicKeySpec</span> <span class=n>publicKeySpec</span> <span class=o>=</span> <span class=k>new</span> <span class=n>java</span><span class=o>.</span><span class=na>security</span><span class=o>.</span><span class=na>spec</span><span class=o>.</span><span class=na>RSAPublicKeySpec</span><span class=o>(</span><span class=n>privk</span><span class=o>.</span><span class=na>getModulus</span><span class=o>(),</span> <span class=n>privk</span><span class=o>.</span><span class=na>getPublicExponent</span><span class=o>());</span>
</span></span><span class=line><span class=cl>            <span class=n>KeyFactory</span> <span class=n>keyFactory</span> <span class=o>=</span> <span class=n>KeyFactory</span><span class=o>.</span><span class=na>getInstance</span><span class=o>(</span><span class=s>&#34;RSA&#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl>            <span class=n>PublicKey</span> <span class=n>publicKey</span> <span class=o>=</span> <span class=n>keyFactory</span><span class=o>.</span><span class=na>generatePublic</span><span class=o>(</span><span class=n>publicKeySpec</span><span class=o>);</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=n>publicKey</span><span class=o>;</span>
</span></span><span class=line><span class=cl>        <span class=o>}</span><span class=k>catch</span><span class=o>(</span><span class=n>Exception</span> <span class=n>e</span><span class=o>){</span>
</span></span><span class=line><span class=cl>            <span class=n>log</span><span class=o>.</span><span class=na>error</span><span class=o>(</span><span class=s>&#34;Cannot read public key {}&#34;</span><span class=o>,</span> <span class=n>e</span><span class=o>);</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=kc>null</span><span class=o>;</span>
</span></span><span class=line><span class=cl>        <span class=o>}</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=n>PrivateKey</span> <span class=nf>getPrivateKey</span><span class=o>(){</span>
</span></span><span class=line><span class=cl>        <span class=k>try</span><span class=o>{</span>
</span></span><span class=line><span class=cl>            <span class=n>log</span><span class=o>.</span><span class=na>info</span><span class=o>(</span><span class=s>&#34;Read key {}&#34;</span><span class=o>,</span> <span class=n>privateKeyString</span><span class=o>);</span>
</span></span><span class=line><span class=cl>            <span class=kt>byte</span><span class=o>[]</span> <span class=n>keyBytes</span> <span class=o>=</span> <span class=n>privateKeyString</span><span class=o>.</span><span class=na>getBytes</span><span class=o>();</span>
</span></span><span class=line><span class=cl>            <span class=n>PKCS8EncodedKeySpec</span> <span class=n>spec</span> <span class=o>=</span> <span class=k>new</span> <span class=n>PKCS8EncodedKeySpec</span><span class=o>(</span><span class=n>keyBytes</span><span class=o>);</span>
</span></span><span class=line><span class=cl>            <span class=n>KeyFactory</span> <span class=n>kf</span> <span class=o>=</span> <span class=n>KeyFactory</span><span class=o>.</span><span class=na>getInstance</span><span class=o>(</span><span class=s>&#34;RSA&#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=n>kf</span><span class=o>.</span><span class=na>generatePrivate</span><span class=o>(</span><span class=n>spec</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=o>}</span><span class=k>catch</span><span class=o>(</span><span class=n>Exception</span> <span class=n>e</span><span class=o>){</span>
</span></span><span class=line><span class=cl>            <span class=n>log</span><span class=o>.</span><span class=na>error</span><span class=o>(</span><span class=s>&#34;Cannot read private key {}&#34;</span><span class=o>,</span> <span class=n>e</span><span class=o>);</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=kc>null</span><span class=o>;</span>
</span></span><span class=line><span class=cl>        <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></td></tr></table></div></div><p>The authentication source code is available on <a href=https://github.com/plotkai-interactive/edge-auth>github</a> where you can explore the The Authorization - Part 2 flow we will be covering in next tutorial along with basics about <a href=#>Open Policy Agent</a>. This whole edge auth module will also be a used in an upcoming tutorial for <a href=../istio-service-mesh-in-kubernetes>istio and it&rsquo;s benefits</a> in <a href=../getting-started-with-kubernetes-manifests>kubernetes</a>.</p><p>Also, we are trying to build the edge-auth as a generic container image for secure system communications in a microservice architecture. If you like building stuff and want to work on FOSS projects feel free to reach out and contribute to the project.</p><style>#share-buttons{display:inline-block;vertical-align:middle}#share-buttons:after{content:"";display:block;clear:both}#share-buttons>div{position:relative;text-align:left;height:36px;width:32px;float:left;text-align:center}#share-buttons>div>svg{height:16px;fill:#d5d5d5;margin-top:10px}#share-buttons>div:hover{cursor:pointer}#share-buttons>div.facebook:hover>svg{fill:#3b5998}#share-buttons>div.twitter:hover>svg{fill:#55acee}#share-buttons>div.linkedin:hover>svg{fill:#0077b5}#share-buttons>div.pinterest:hover>svg{fill:#cb2027}#share-buttons>div.mail:hover>svg{fill:#7d7d7d}#share-buttons>div.facebook>svg{height:18px;margin-top:9px}#share-buttons>div.twitter>svg{height:20px;margin-top:8px}#share-buttons>div.linkedin>svg{height:19px;margin-top:7px}#share-buttons>div.pinterest>svg{height:20px;margin-top:9px}#share-buttons>div.mail>svg{height:14px;margin-top:11px}</style><span style=color:silver>Share with others on</span><div id=share-buttons><div class=facebook title="Share this on Facebook" onclick='window.open("http://www.facebook.com/share.php?u=https://blog.devutkarsh.com/edge-auth-authentication-part-1/")'><svg viewBox="0 0 1792 1792" xmlns="http://www.w3.org/2000/svg"><path d="M1343 12v264h-157q-86 0-116 36t-30 108v189h293l-39 296h-254v759H734V905H479V609h255V391q0-186 104-288.5T1115 0q147 0 228 12z"/></svg></div><div class=twitter title="Share this on Twitter" onclick='window.open("http://twitter.com/intent/tweet?text=Edge Auth - Authentication - Part 1&url=https://blog.devutkarsh.com/edge-auth-authentication-part-1/")'><svg viewBox="0 0 1792 1792" xmlns="http://www.w3.org/2000/svg"><path d="M1684 408q-67 98-162 167 1 14 1 42 0 130-38 259.5T1369.5 1125 1185 1335.5t-258 146-323 54.5q-271 0-496-145 35 4 78 4 225 0 401-138-105-2-188-64.5T285 1033q33 5 61 5 43 0 85-11-112-23-185.5-111.5T172 710v-4q68 38 146 41-66-44-105-115t-39-154q0-88 44-163 121 149 294.5 238.5T884 653q-8-38-8-74 0-134 94.5-228.5T1199 256q140 0 236 102 109-21 205-78-37 115-142 178 93-10 186-50z"/></svg></div><div class=linkedin title="Share this on Linkedin" onclick='window.open("https://www.linkedin.com/shareArticle?mini=true&url=https://blog.devutkarsh.com/edge-auth-authentication-part-1/&title=&summary=&source=")'><svg viewBox="0 0 1792 1792" xmlns="http://www.w3.org/2000/svg"><path d="M477 625v991H147V625h330zm21-306q1 73-50.5 122T312 490h-2q-82 0-132-49t-50-122q0-74 51.5-122.5T314 148t133 48.5T498 319zm1166 729v568h-329v-530q0-105-40.5-164.5T1168 862q-63 0-105.5 34.5T999 982q-11 30-11 81v553H659q2-399 2-647t-1-296l-1-48h329v144h-2q20-32 41-56t56.5-52 87-43.5T1285 602q171 0 275 113.5t104 332.5z"/></svg></div><div class=mail title="Share this through Email" onclick='window.open("mailto:?&body=https://blog.devutkarsh.com/edge-auth-authentication-part-1/")'><svg viewBox="0 0 1792 1792" xmlns="http://www.w3.org/2000/svg"><path d="M1792 710v794q0 66-47 113t-113 47H160q-66 0-113-47T0 1504V710q44 49 101 87 362 246 497 345 57 42 92.5 65.5t94.5 48 110 24.5h2q51 0 110-24.5t94.5-48 92.5-65.5q170-123 498-345 57-39 1e2-87zm0-294q0 79-49 151t-122 123q-376 261-468 325-10 7-42.5 30.5t-54 38-52 32.5-57.5 27-50 9h-2q-23 0-50-9t-57.5-27-52-32.5-54-38T639 1015q-91-64-262-182.5T172 690q-62-42-117-115.5T0 438q0-78 41.5-130T160 256h1472q65 0 112.5 47t47.5 113z"/></svg></div></div></div></div><div class=container><nav class="flex container suggested"><a rel=prev href=/istio-service-mesh-in-kubernetes/ title="Previous post (older)"><span>Previous</span>
Istio service mesh in kubernetes</a></nav></div><div class=container></div></main></main><footer class="footer flex"><section class=container><nav class=footer-links><a href=/> 2021</a></nav></section><script defer src=/ts/features.450f4ecb1f04c7e548ef6f725f6d4da62844d944cc285f50ce972fb71dd2c168.js data-enable-footnotes=true></script></footer></body></html>