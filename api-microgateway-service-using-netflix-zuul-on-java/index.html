<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  
<title>API-microgateway service using Netflix Zuul on Java | Dev Utkarsh</title>



<meta property="og:title" content="API-microgateway service using Netflix Zuul on Java">



<meta name="author" content="Dev Utkarsh">


<meta property="og:locale" content="en_US">


<meta name="description" content="Verbose out on tech, travel and music.">
<meta property="og:description" content="Verbose out on tech, travel and music.">



<link rel="canonical" href="https://blog.devutkarsh.com/api-microgateway-service-using-netflix-zuul-on-java/">
<meta property="og:url" content="https://blog.devutkarsh.com/api-microgateway-service-using-netflix-zuul-on-java/">



<meta property="og:site_name" content="Dev Utkarsh" />



  <meta property="og:image" content="https://blog.devutkarsh.com/tale.png">
  
  



  <meta property="og:type" content="article" />
  <meta property="article:published_time" content="2020-06-11T11:11:00+00:00">



  <link rel="prev" href="https://blog.devutkarsh.com/api-gateway-vs-edge-proxy-service-vs-api-microgateway/">





  <meta name="twitter:card" content="summary_large_image"">
  <meta property="twitter:image" content="https://blog.devutkarsh.com/tale.png">



  <meta property="twitter:title" content="API-microgateway service using Netflix Zuul on Java">



  <meta name="twitter:site" content="@devutkarsh">
  



  
    <meta property="fb:admins" content="devutkarsh" />
  

  
    <meta property="article:publisher" content="devutkarsh" />
  

  



  

  

  

  

  


<script type="application/ld+json">
{
  "author": {
    "@type":"Person",
	  "name":"Dev Utkarsh"
  },
  "description": "Verbose out on tech, travel and music.",
  "url": "https://blog.devutkarsh.com/api-microgateway-service-using-netflix-zuul-on-java/",
  "@context":"https://schema.org",
  "@type": "BlogPosting",
  "headline": "API-microgateway service using Netflix Zuul on Java",
  
    
    
      "datePublished":"2020-06-11T11:11:00+00:00",
    
    "mainEntityOfPage":{
      "@type":"WebPage",
      "@id":"https://blog.devutkarsh.com/api-microgateway-service-using-netflix-zuul-on-java/"
    }
  
}
</script>

  <link rel="stylesheet" href="https://blog.devutkarsh.com/main.css">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Libre+Baskerville:400,400i,700">

  <link rel="icon" type="image/png" sizes="32x32" href="https://blog.devutkarsh.com/assets/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="https://blog.devutkarsh.com/assets/favicon-16x16.png">
  <link rel="apple-touch-icon" sizes="180x180" href="https://blog.devutkarsh.com/assets/apple-touch-icon.png">

  
    <link type="application/atom+xml" rel="alternate" href="https://blog.devutkarsh.com/atom.xml" title="Dev Utkarsh" />
  

  

  
  
</head>

<body>
  
  <nav class="nav">
    <div class="nav-container">
      <a href="https://blog.devutkarsh.com">
        <h2 class="nav-title">Dev Utkarsh</h2>
      </a>
      <p>Verbose out on tech, travel and music.</p>
      <ul>
        
          
            <li><a href="https://blog.devutkarsh.com">Posts</a></li>
          
            <li><a href="https://blog.devutkarsh.com/tags">Tags</a></li>
          
        
          <li><a href="https://devutkarsh.com#about">About</a></li>
      </ul>
    </div>
  </nav>
  

  <main>
    
  <div class="post">
  	<!--div class="post-info">
  		<span>Written by</span> Dev Utkarsh<br>
  		
  		<span>on&nbsp;</span><time datetime="2020-06-11T11:11:00+00:00">Jun 11, 20</time>
  	</div-->
  	<h1 class="post-title">API-microgateway service using Netflix Zuul on Java</h1>
  	<div class="post-line"></div>
  	<h2 id="how-to-write-an-api-service-or-edge-service-or-api-gateway">How to write an api-service or edge-service or api-gateway?</h2>
<p><img src="../assets/images/tech/api-service.jpeg" alt="s3-and-lambda" /></p>
<p>So we are here today to write a gateway microservice using <em><strong>Springboot</strong></em> framework, <em><strong>Netflix's Zuul</strong></em> library, and our never-getting-old programming language <em><strong>Java</strong></em>.  As a part of this development, we will be using <em><strong>Gradle</strong></em> to build this together and prepare the <em><strong>Docker</strong></em> image out of it. </p>
<p>If you are not sure yet, what this api-service is going to help you with, I recommend reading out  <a href="https://blog.devutkarsh.com/api-gateway-vs-edge-proxy-service-vs-api-microgateway"><em>What is api-microgateway?</em></a>. </p>
<ul>
<li>First create a Gradle project in your favorite IDE.</li>
<li>Update the <strong>build.gradle</strong> file with following settings -</li>
</ul>
<pre style="background-color:#272822;">
<code class="language-gradle" data-lang="gradle"><span style="color:#f8f8f2;">plugins {
	id </span><span style="color:#e6db74;">&#39;org.springframework.boot&#39;</span><span style="color:#f8f8f2;"> version </span><span style="color:#e6db74;">&#39;2.3.3.RELEASE&#39;
</span><span style="color:#f8f8f2;">	id </span><span style="color:#e6db74;">&#39;java&#39;
</span><span style="color:#f8f8f2;">	id </span><span style="color:#e6db74;">&#39;application&#39;
</span><span style="color:#f8f8f2;">}
apply </span><span style="color:#ae81ff;">plugin</span><span style="color:#f8f8f2;">: </span><span style="color:#e6db74;">&#39;io.spring.dependency-management&#39;
</span><span style="color:#f8f8f2;">dependencies {
   implementation </span><span style="color:#e6db74;">&#39;org.springframework.boot:spring-boot-starter-web&#39;
</span><span style="color:#f8f8f2;">   implementation </span><span style="color:#e6db74;">&#39;org.springframework.cloud:spring-cloud-starter-netflix-zuul&#39;
</span><span style="color:#f8f8f2;">}
</span></code></pre>
<ul>
<li>Refresh your Gradle project to download the defined dependencies from their respective repository.</li>
<li>Update your main class of the Java application with SpringBoot and Zuul Annotation as below -</li>
</ul>
<pre style="background-color:#272822;">
<code class="language-java" data-lang="java"><span style="color:#f8f8f2;">@EnableZuulProxy
@SpringBootApplication
</span><span style="color:#f92672;">public </span><span style="font-style:italic;color:#66d9ef;">class </span><span style="text-decoration:underline;color:#a6e22e;">ApplicationEntryPoint </span><span style="color:#f8f8f2;">{
	</span><span style="color:#f92672;">public static </span><span style="font-style:italic;color:#66d9ef;">void </span><span style="color:#a6e22e;">main</span><span style="color:#f8f8f2;">(</span><span style="font-style:italic;color:#66d9ef;">String</span><span style="color:#f92672;">[] </span><span style="font-style:italic;color:#fd971f;">args</span><span style="color:#f8f8f2;">) {
		</span><span style="font-style:italic;color:#66d9ef;">SpringApplication</span><span style="color:#f8f8f2;">.run(</span><span style="font-style:italic;color:#66d9ef;">ApplicationEntryPoint</span><span style="color:#f8f8f2;">.class, args);
	}
}
</span></code></pre>
<p>Now your basic api-gateway is ready to serve but needs to be configured with routing settings.</p>
<h2 id="edge-service-or-routing-endpoint">Edge Service or Routing Endpoint</h2>
<p>To set up routes, we will modify the <em><strong>application.yaml</strong></em> file which is responsible for helping our spring boot application in reading the dynamic configs.</p>
<ul>
<li>Update settings in your <em><strong>application.properties</strong></em> or <em><strong>application.yaml</strong></em> as follows -</li>
</ul>
<pre style="background-color:#272822;">
<code class="language-yaml" data-lang="yaml"><span style="color:#f92672;">spring</span><span style="color:#f8f8f2;">:
  </span><span style="color:#f92672;">application</span><span style="color:#f8f8f2;">:
    </span><span style="color:#f92672;">name</span><span style="color:#f8f8f2;">: </span><span style="color:#f92672;">api-service

server</span><span style="color:#f8f8f2;">:
  </span><span style="color:#f92672;">port</span><span style="color:#f8f8f2;">: </span><span style="color:#ae81ff;">8080
  
</span><span style="color:#f92672;">zuul</span><span style="color:#f8f8f2;">:
  </span><span style="color:#f92672;">routes</span><span style="color:#f8f8f2;">:
    </span><span style="color:#f92672;">example</span><span style="color:#f8f8f2;">:
      </span><span style="color:#f92672;">url</span><span style="color:#f8f8f2;">: </span><span style="color:#f92672;">https://example.com

ribbon</span><span style="color:#f8f8f2;">:
  </span><span style="color:#f92672;">eureka</span><span style="color:#f8f8f2;">:
    </span><span style="color:#f92672;">enabled</span><span style="color:#f8f8f2;">: </span><span style="color:#ae81ff;">false
</span></code></pre>
<p>Here in the setting the child property under <strong>zuul.routes</strong> which is <strong>example</strong> is the <em>URI path</em> or say <em>serviceId</em> which is responsible for redirecting the request to the targeted endpoint that is mentioned as the value for <strong>url</strong> property.</p>
<p>Now you can run your spring-boot application and hit the localhost:8080/example on the browser.</p>
<blockquote>
</blockquote>
<p>So any request that we make after running our application and hitting the endpoint
http://localhost:8080/example/xyz 
will send all requests and headers to downstream service at http://example.com/xyz</p>
<p>The response from the downstream service is then sent back and our api-service which in turn sends the response to the requesting client which will be your browser.</p>
<h2 id="security-filters-or-request-filter">Security Filters or Request Filter</h2>
<p>This is an add-on to your routing service where you can write a filter that can modify your headers or check for Authorization. Basically, any sanitization that needs to be done on the request before sending it further downstream can be applied here.</p>
<ul>
<li>
<p>Create a new class <em>RequestFilter.java</em> and extend the abstract class <em>ZuulFilter</em>. As a part of your inherited behavior of ZuulFilter you will then need to override the below mentioned 4 methods :</p>
<p><strong>shouldFilter()</strong> - responsible if you want to enable this filter or not.</p>
<p><strong>run()</strong> - the logic on how what needs to be done with the request.</p>
<p><strong>filterType()</strong> - evaluates when this filter need to be applied i.e. pre, post or route.</p>
<p><strong>filterOrder()</strong> - if there are multiple filters operating, then on what order does it comes.</p>
</li>
</ul>
<pre style="background-color:#272822;">
<code class="language-java" data-lang="java"><span style="color:#f92672;">public </span><span style="font-style:italic;color:#66d9ef;">class </span><span style="text-decoration:underline;color:#a6e22e;">RequestFilter </span><span style="color:#f92672;">extends </span><span style="text-decoration:underline;font-style:italic;color:#a6e22e;">ZuulFilter </span><span style="color:#f8f8f2;">{
    @Override
    </span><span style="color:#f92672;">public </span><span style="font-style:italic;color:#66d9ef;">boolean </span><span style="color:#a6e22e;">shouldFilter</span><span style="color:#f8f8f2;">() {
        </span><span style="color:#f92672;">return </span><span style="color:#ae81ff;">true</span><span style="color:#f8f8f2;">;
    }
    @Override
    </span><span style="color:#f92672;">public </span><span style="font-style:italic;color:#66d9ef;">Object </span><span style="color:#a6e22e;">run</span><span style="color:#f8f8f2;">() </span><span style="color:#f92672;">throws </span><span style="font-style:italic;color:#66d9ef;">ZuulException </span><span style="color:#f8f8f2;">{ 
        </span><span style="font-style:italic;color:#66d9ef;">RequestContext</span><span style="color:#f8f8f2;"> ctx </span><span style="color:#f92672;">= </span><span style="font-style:italic;color:#66d9ef;">RequestContext</span><span style="color:#f8f8f2;">.getCurrentContext();
        </span><span style="font-style:italic;color:#66d9ef;">System</span><span style="color:#f8f8f2;">.out.println(</span><span style="color:#e6db74;">&quot;Requested Endpoint : &quot; </span><span style="color:#f92672;">+</span><span style="color:#f8f8f2;"> ctx.getRequest().getRequestURI());
        </span><span style="color:#75715e;">// all the logic goes here for request manipulation
        </span><span style="color:#f92672;">return </span><span style="color:#ae81ff;">null</span><span style="color:#f8f8f2;">;
    }
    @Override
    </span><span style="color:#f92672;">public </span><span style="font-style:italic;color:#66d9ef;">String </span><span style="color:#a6e22e;">filterType</span><span style="color:#f8f8f2;">() {
        </span><span style="color:#f92672;">return </span><span style="color:#e6db74;">&quot;pre&quot;</span><span style="color:#f8f8f2;">;
    }
    @Override
    </span><span style="color:#f92672;">public </span><span style="font-style:italic;color:#66d9ef;">int </span><span style="color:#a6e22e;">filterOrder</span><span style="color:#f8f8f2;">() {
        </span><span style="color:#f92672;">return </span><span style="color:#ae81ff;">5</span><span style="color:#f8f8f2;">;
    }
}
</span></code></pre>
<p>Your main application class needs to define the Bean for this request filter to help Zuul servlet chain the filter settings.</p>
<pre style="background-color:#272822;">
<code class="language-java" data-lang="java"><span style="color:#f8f8f2;">@EnableZuulProxy
@SpringBootApplication
</span><span style="color:#f92672;">public </span><span style="font-style:italic;color:#66d9ef;">class </span><span style="text-decoration:underline;color:#a6e22e;">ApplicationEntryPoint </span><span style="color:#f8f8f2;">{
	</span><span style="color:#f92672;">public static </span><span style="font-style:italic;color:#66d9ef;">void </span><span style="color:#a6e22e;">main</span><span style="color:#f8f8f2;">(</span><span style="font-style:italic;color:#66d9ef;">String</span><span style="color:#f92672;">[] </span><span style="font-style:italic;color:#fd971f;">args</span><span style="color:#f8f8f2;">) {
		</span><span style="font-style:italic;color:#66d9ef;">SpringApplication</span><span style="color:#f8f8f2;">.run(</span><span style="font-style:italic;color:#66d9ef;">ApplicationEntryPoint</span><span style="color:#f8f8f2;">.class, args);
	}
	@Bean
	</span><span style="font-style:italic;color:#66d9ef;">RequestFilter </span><span style="color:#a6e22e;">getRequestFilterBean</span><span style="color:#f8f8f2;">(){
		</span><span style="color:#f92672;">return new </span><span style="font-style:italic;color:#66d9ef;">RequestFilter</span><span style="color:#f8f8f2;">();
	}
</span></code></pre>
<blockquote>
<p>Similarly you can create a response filter with <strong>filterType</strong> as <strong>Post</strong> and that can be used to manipulate the response from your downstream service before sending it back to your browser client.</p>
</blockquote>
<p>A complete sample of this can be found on my git repository -&gt; <a href="https://github.com/devutkarsh/gateway-service">api-microgateway</a> </p>

  </div>

	

  <div class="pagination">
  	<a href="https://blog.devutkarsh.com/a-month-bagpacking-in-sikkim/" class="left arrow">&#8592;</a>
		<a href="#" class="top">Top</a>
		<a href="https://blog.devutkarsh.com/api-gateway-vs-edge-proxy-service-vs-api-microgateway/" class="right arrow">&#8594;</a>
  </div>

  </main>

  
  <footer>
    <span>&copy; <time datetime="2021-09-17T20:02:35.039951352+00:00">2021</time> Dev Utkarsh. Powered by <a href="https://www.getzola.org">Zola</a> on <a href="https://pages.github.com/">Github Pages</a>. <br/>Made with ❤️  in India.</span>
  </footer>
  
</body>
</html>
